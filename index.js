import { initNavbarAuthUI } from "./shared-ui.js"; import { db } from "./firebase.js"; import { doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js"; initNavbarAuthUI(); /* ========================= Notice / Announcement Ticker (NEW) ========================= */ function initNoticeTicker(){ const track = document.getElementById("noticeTrack"); const closeBtn = document.getElementById("noticeClose"); const bar = document.getElementById("noticeBar"); if (!track || !bar) return; // If user closed earlier try{ if (localStorage.getItem("ls_notice_closed") === "1") { bar.style.display = "none"; return; } } catch {} function initNoticeTicker(){ const track = document.getElementById("noticeTrack"); if (!track) return; const notices = [ { text: "আগামী শুক্রবার সেবা কার্যক্রম", icon: "fa-hands-praying", linkText: "Details", link: "vision.html" }, { text: "সদস্য সংগ্রহ শুরু — রেজিস্ট্রেশন চলছে", icon: "fa-snowflake", linkText: "Register", link: "contact.html" }, { text: "জরুরি সাহায্য ফান্ড চালু", icon: "fa-hand-holding-heart", linkText: "Donate", link: "donate.html" } ]; const html = notices.map(n => <span class="notice-item"> <span class="notice-dot"></span> <i class="fa-solid ${n.icon}"></i> <b>${n.text}</b> ${n.link ? <a class="notice-link" href="${n.link}">${n.linkText || "View"}</a> : `} </span> ).join(""); // duplicate for seamless infinite scroll track.innerHTML = html + html; } closeBtn?.addEventListener("click", () => { bar.style.display = "none"; try{ localStorage.setItem("ls_notice_closed","1"); } catch {} }); } /* ========================= Existing DOM helpers + nav (kept) ========================= */ (() => { const $ = (s, p = document) => p.querySelector(s); const yearEl = $("#year"); if (yearEl) yearEl.textContent = new Date().getFullYear(); const navToggle = $("#navToggle"); const navMenu = $("#navMenu"); if (navToggle && navMenu) { const close = () => { navMenu.classList.remove("open"); navToggle.setAttribute("aria-expanded", "false"); }; navToggle.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); const open = !navMenu.classList.contains("open"); navMenu.classList.toggle("open", open); navToggle.setAttribute("aria-expanded", String(open)); }, { passive: false }); document.addEventListener("click", (e) => { if (!navMenu.classList.contains("open")) return; if (navMenu.contains(e.target) || navToggle.contains(e.target)) return; close(); }); navMenu.addEventListener("click", (e) => { const a = e.target.closest && e.target.closest("a"); if (a) close(); }); window.addEventListener("resize", () => { if (window.innerWidth > 860) close(); }); } const statMembers = $("#statMembers"); const statCollected = $("#statCollected"); const statDues = $("#statDues"); const statFund = $("#statFund"); const statOtherIncome = $("#statOtherIncome"); const statExpense = $("#statExpense"); onSnapshot(doc(db, "stats", "global"), (snap) => { const s = snap.data() || {}; if (statMembers) statMembers.textContent = s.totalMembers ?? 0; if (statCollected) statCollected.textContent = s.totalCollectedYTD ?? 0; if (statDues) statDues.textContent = s.totalDues ?? 0; if (statFund) statFund.textContent = s.availableFund ?? 0; if (statOtherIncome) statOtherIncome.textContent = s.totalOtherIncome ?? 0; if (statExpense) statExpense.textContent = s.totalExpense ?? 0; }); const heroSearch = $("#heroSearch"); const heroSearchBtn = $("#heroSearchBtn"); const goSearch = () => { const q = (heroSearch?.value || "").trim(); location.href = q ? member-search.html?q=${encodeURIComponent(q)} : "member-search.html"; }; heroSearchBtn?.addEventListener("click", goSearch); heroSearch?.addEventListener("keydown", (e) => { if (e.key === "Enter") goSearch(); }); })(); window.addEventListener("DOMContentLoaded", () => { initNoticeTicker(); });
